{"ast":null,"code":"import React, { useEffect, useMemo, useState } from 'react';\nimport { MaterialReactTable, useMaterialReactTable } from 'material-react-table';\nimport axios from 'axios';\nimport { Box, Stack } from '@mui/material';\nconst monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\nconst columns = [{\n  accessorKey: 'id',\n  header: 'Id',\n  size: 100,\n  enableColumnFilter: false,\n  enableEditing: false,\n  enableSorting: false\n}, {\n  accessorKey: 'emp_name',\n  header: 'Employee Name',\n  size: 150,\n  enableEditing: false,\n  enableColumnFilter: true\n}];\nmonthNames.forEach(month => {\n  columns.push({\n    header: month,\n    // footer: 'Total',\n    accessorKey: month.toLowerCase(),\n    editVariant: \"select\",\n    editSelectOptions: [\"Yes\", \"No\"],\n    size: 100,\n    enableEditing: true,\n    enableColumnFilter: true,\n    filterVariant: \"select\",\n    filterSelectOptions: [\"Yes\", \"No\"],\n    aggregationFn: 'sum',\n    muiEditTextFieldProps: ({\n      cell\n    }) => ({\n      onchange: event => {\n        console.log(cell.row.original.id, event.target);\n        handleCellValueChange(cell.row.original.id, event.target.name, event.target.value);\n      }\n    }),\n    Footer: () => /*#__PURE__*/React.createElement(Stack, null, \"Total:\")\n  });\n});\nconst handleCellValueChange = (emp_id, month_name, is_billable) => {\n  axios.patch(\"api/editBillingInfo\", {\n    emp_id,\n    month_name,\n    is_billable\n  }).then(() => {\n    console.log(\"Edit Done\");\n  }).catch(() => {\n    console.log(\"Edit error\");\n  });\n};\nconst FetchEmployee = ({\n  employeeRefetch,\n  setEmployeeRefetech\n}) => {\n  const [combinedData, setCombinedData] = useState([]);\n  useEffect(() => {\n    axios.get('api/fetchEmployeeBilling').then(response => {\n      const {\n        billing_data,\n        employee_data\n      } = response.data;\n      const mergedData = mergeData(billing_data, employee_data);\n      setCombinedData(mergedData);\n      setEmployeeRefetech(false);\n    });\n  }, [employeeRefetch]);\n  const mergeData = (billingData, employeeData) => {\n    const employeeMap = {};\n    console.log(employeeMap);\n    employeeData.forEach(employee => {\n      employeeMap[employee.id] = {\n        id: employee.id,\n        emp_name: employee.emp_name,\n        ...Object.fromEntries(monthNames.map(month => [month.toLowerCase(), '']))\n      };\n    });\n    billingData.forEach(billing => {\n      const {\n        emp_id,\n        month_name,\n        is_billable\n      } = billing;\n      if (employeeMap[emp_id]) {\n        employeeMap[emp_id][month_name] = is_billable ? \"Yes\" : \"No\";\n      }\n    });\n    return Object.values(employeeMap);\n  };\n  const handleCellEdit = (emp_id, month_name, is_billable) => {\n    console.log(emp_id, month_name, is_billable);\n    axios.post(\"api/createBilling\", {\n      emp_id,\n      month_name,\n      is_billable\n    }).then(() => {\n      console.log(\"Done\");\n    }).catch(() => console.log(\"Error\"));\n  };\n  const table = useMaterialReactTable({\n    columns,\n    data: combinedData,\n    enableColumnPinning: true,\n    enablePagination: false,\n    initialState: {\n      showColumnFilters: true,\n      columnPinning: {\n        left: ['id', 'emp_name']\n      }\n    },\n    enableFullScreenToggle: false,\n    enableEditing: true,\n    // muiEditTextFieldProps: ({ cell }) => ({\n    //   onBlur: (event) => {\n    //     console.log(event, cell.row.original.id, event.target);\n    //     handleCellValueChange(cell.row.original.id, event.target.name, event.target.value);\n    //   },\n    // }),\n    editDisplayMode: 'cell',\n    //table\n\n    enableEditing: true,\n    muiTableBodyCellProps: ({\n      cell\n    }) => ({\n      onBlur: () => {\n        // console.log(cell.getValue())\n        handleCellEdit(cell.row.original.id, cell.column.id, cell.getValue());\n      }\n      // onEditingCellChange: handleCellValueChange,\n    })\n  });\n  return /*#__PURE__*/React.createElement(MaterialReactTable, {\n    table: table\n  });\n};\nexport default FetchEmployee;","map":{"version":3,"names":["React","useEffect","useMemo","useState","MaterialReactTable","useMaterialReactTable","axios","Box","Stack","monthNames","columns","accessorKey","header","size","enableColumnFilter","enableEditing","enableSorting","forEach","month","push","toLowerCase","editVariant","editSelectOptions","filterVariant","filterSelectOptions","aggregationFn","muiEditTextFieldProps","cell","onchange","event","console","log","row","original","id","target","handleCellValueChange","name","value","Footer","createElement","emp_id","month_name","is_billable","patch","then","catch","FetchEmployee","employeeRefetch","setEmployeeRefetech","combinedData","setCombinedData","get","response","billing_data","employee_data","data","mergedData","mergeData","billingData","employeeData","employeeMap","employee","emp_name","Object","fromEntries","map","billing","values","handleCellEdit","post","table","enableColumnPinning","enablePagination","initialState","showColumnFilters","columnPinning","left","enableFullScreenToggle","editDisplayMode","muiTableBodyCellProps","onBlur","column","getValue"],"sources":["/home/softsuave/ROR Series/HTML/Project/Internal Project/ResourceManagement/app/javascript/resource-management/components/FetchEmployee/index.jsx"],"sourcesContent":["import React, { useEffect, useMemo, useState } from 'react';\nimport { MaterialReactTable, useMaterialReactTable } from 'material-react-table';\nimport axios from 'axios';\nimport { Box, Stack } from '@mui/material';\n\nconst monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n\nconst columns = [\n  {\n    accessorKey: 'id',\n    header: 'Id',\n    size: 100,\n    enableColumnFilter: false,\n    enableEditing: false,\n    enableSorting: false,\n  },\n  {\n    accessorKey: 'emp_name',\n    header: 'Employee Name',\n    size: 150,\n    enableEditing: false,\n    enableColumnFilter: true,\n  },\n];\n\nmonthNames.forEach((month) => {\n  columns.push({\n    header: month,\n    // footer: 'Total',\n    accessorKey: month.toLowerCase(),\n    editVariant: \"select\",\n    editSelectOptions: [\"Yes\", \"No\"],\n    size: 100,\n    enableEditing: true,\n    enableColumnFilter: true,\n    filterVariant: \"select\",\n    filterSelectOptions: [\"Yes\", \"No\"],\n    aggregationFn: 'sum',\n    muiEditTextFieldProps: ({ cell }) => ({\n      onchange: (event) => {\n        console.log(cell.row.original.id, event.target);\n        handleCellValueChange(cell.row.original.id, event.target.name, event.target.value);\n      },\n    }),\n    Footer: () => (\n      <Stack>\n        Total:\n\n\n        {/* <Box color=\"warning.main\">{Math.round(maxYes)}</Box> */}\n      </Stack>\n    ),\n  });\n\n});\nconst handleCellValueChange = (emp_id, month_name, is_billable) => {\n  axios.patch(\"api/editBillingInfo\", {\n    emp_id, month_name, is_billable\n  }).then(() => {\n    console.log(\"Edit Done\")\n  }).catch(() => {\n    console.log(\"Edit error\")\n  })\n}\n\n\nconst FetchEmployee = ({ employeeRefetch, setEmployeeRefetech }) => {\n  const [combinedData, setCombinedData] = useState([]);\n\n  useEffect(() => {\n    axios.get('api/fetchEmployeeBilling').then((response) => {\n      const { billing_data, employee_data } = response.data;\n      const mergedData = mergeData(billing_data, employee_data);\n      setCombinedData(mergedData);\n      setEmployeeRefetech(false);\n    });\n  }, [employeeRefetch]);\n\n  const mergeData = (billingData, employeeData) => {\n    const employeeMap = {};\n    console.log(employeeMap)\n    employeeData.forEach(employee => {\n      employeeMap[employee.id] = {\n        id: employee.id,\n        emp_name: employee.emp_name,\n        ...Object.fromEntries(monthNames.map(month => [month.toLowerCase(), ''])),\n      };\n    });\n\n    billingData.forEach(billing => {\n      const { emp_id, month_name, is_billable } = billing;\n      if (employeeMap[emp_id]) {\n        employeeMap[emp_id][month_name] = is_billable ? \"Yes\" : \"No\";\n      }\n    });\n\n    return Object.values(employeeMap);\n  };\n\n  const handleCellEdit = (emp_id, month_name, is_billable) => {\n    console.log(emp_id, month_name, is_billable)\n    axios.post(\"api/createBilling\", {\n      emp_id, month_name, is_billable\n\n    }).then(() => {\n      console.log(\"Done\")\n    }).catch(() => console.log(\"Error\"));\n  }\n\n\n\n  const table = useMaterialReactTable({\n    columns,\n    data: combinedData,\n    enableColumnPinning: true,\n    enablePagination: false,\n    initialState: {\n      showColumnFilters: true,\n      columnPinning: { left: ['id', 'emp_name'] },\n    },\n    enableFullScreenToggle: false,\n    enableEditing: true,\n    // muiEditTextFieldProps: ({ cell }) => ({\n    //   onBlur: (event) => {\n    //     console.log(event, cell.row.original.id, event.target);\n    //     handleCellValueChange(cell.row.original.id, event.target.name, event.target.value);\n    //   },\n    // }),\n    editDisplayMode: 'cell', //table\n\n    enableEditing: true,\n    muiTableBodyCellProps: ({ cell }) => ({\n      onBlur: () => {\n        // console.log(cell.getValue())\n        handleCellEdit(cell.row.original.id, cell.column.id, cell.getValue())\n      },\n      // onEditingCellChange: handleCellValueChange,\n    }),\n  });\n  return (\n\n    <MaterialReactTable table={table} />\n\n  );\n};\n\nexport default FetchEmployee;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}